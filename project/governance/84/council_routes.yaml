# Council Routing Rules (INTERNAL ONLY)
# Version: 2.0.0
# Last Updated: 2025-11-07
# Purpose: Define routing logic from user intents to departments to mentors

version: "2.0.0"
lastUpdated: "2025-11-07"
description: "Routing rules for decision classification and advisor recruitment"

# Decision Types
# Maps user intent categories to decision frameworks
decisionTypes:
  strategy:
    description: "Long-term positioning, moat-building, market differentiation"
    primaryDepartments:
      - "Strategy"
      - "Finance & IR"
      - "Growth"
    secondaryDepartments:
      - "Customer & Design"
    topLenses:
      - "moat"
      - "positioning"
      - "trade-off"
      - "wont-do"
      - "prfaq"
    recruitmentCount: 7
    votingThreshold: 0.71  # 5/7 minimum

  product_prfaq:
    description: "Product features, UX decisions, customer promise alignment"
    primaryDepartments:
      - "Customer & Design"
      - "Strategy"
      - "Growth"
    secondaryDepartments:
      - "AI POD"
      - "Platform"
    topLenses:
      - "prfaq"
      - "customer_promise"
      - "trade-off"
      - "activation"
      - "retention"
    recruitmentCount: 6
    votingThreshold: 0.67  # 4/6 minimum

  infra_slo:
    description: "Infrastructure, performance, reliability, observability"
    primaryDepartments:
      - "Platform"
      - "AI POD"
      - "Operations & Localization"
    secondaryDepartments:
      - "Safety & Governance"
    topLenses:
      - "slo"
      - "error_budget"
      - "observability"
      - "perf_budget"
      - "rollback"
      - "test_coverage"
    recruitmentCount: 7
    votingThreshold: 0.71  # 5/7 minimum

  safety_release:
    description: "Security, privacy, compliance, safe deployment"
    primaryDepartments:
      - "Safety & Governance"
      - "Legal & Compliance"
      - "Platform"
    secondaryDepartments:
      - "AI POD"
    topLenses:
      - "pdpa"
      - "consent"
      - "csp"
      - "audit_log"
      - "rollback"
      - "ttl"
    recruitmentCount: 6
    votingThreshold: 0.83  # 5/6 minimum (higher bar for safety)

  capital_allocation:
    description: "Cost management, pricing, growth investment, unit economics"
    primaryDepartments:
      - "Finance & IR"
      - "Strategy"
      - "Growth"
    secondaryDepartments:
      - "Operations & Localization"
    topLenses:
      - "pricing"
      - "moat"
      - "trade-off"
      - "growth_loop"
      - "cohort"
    recruitmentCount: 5
    votingThreshold: 0.80  # 4/5 minimum

# Department to Mentor Mapping
# (mentor numbers reference council_roster.json)
departmentRoster:
  "Strategy":
    mentors: [1, 2, 22, 23]  # Warren Buffett, Charlie Munger, Muhammad Taqi Usmani, Mufti Menk
    votingWeight: 1.3

  "Finance & IR":
    mentors: [1, 3, 18, 19]  # Warren Buffett, Nassim Taleb, Peter Thiel, Marc Andreessen
    votingWeight: 1.2

  "AI POD":
    mentors: [24, 25, 26, 27, 28, 29, 78, 79, 80, 81, 82, 83, 84]
    # Gene Kim, Sam Altman, Demis Hassabis, Geoffrey Hinton, Yann LeCun, Andrew Ng,
    # Linus Torvalds, Brendan Eich, Bjarne Stroustrup, Chris Lattner, Jeff Dean,
    # Sanjay Ghemawat, Soumith Chintala
    votingWeight: 1.5

  "Platform":
    mentors: [4, 5, 6, 7, 8, 9, 10, 11, 78, 79, 80, 81, 82, 83]
    # Ben Horowitz, Paul Graham, Brian Chesky, Reid Hoffman,
    # Jensen Huang, Patrick Collison, Satya Nadella, Andy Jassy,
    # Elite dev mentors (Linus-Sanjay)
    votingWeight: 1.4

  "Safety & Governance":
    mentors: [15, 16, 17, 22, 23, 38]
    # Bruce Schneier, Arvind Narayanan, Timnit Gebru,
    # Muhammad Taqi Usmani, Mufti Menk, Danielle Citron
    votingWeight: 2.0  # Highest weight - safety critical

  "Legal & Compliance":
    mentors: [38, 39, 40, 41, 42, 22, 23]
    # Danielle Citron, Lawrence Lessig, Cory Doctorow, Alexis Ohanian,
    # Noam Chomsky, Muhammad Taqi Usmani, Mufti Menk
    votingWeight: 1.8

  "Customer & Design":
    mentors: [12, 13, 14, 20, 21, 43, 44, 45]
    # Julie Zhuo, Jony Ive, Dieter Rams, Josh Constine, Casey Newton,
    # Patty McCord, Charity Majors, Margaret Hamilton
    votingWeight: 1.3

  "Growth":
    mentors: [18, 19, 20, 21, 46, 47, 48]
    # Peter Thiel, Marc Andreessen, Josh Constine, Casey Newton,
    # Chamath Palihapitiya, Brian Balfour, Hiten Shah
    votingWeight: 1.2

  "Operations & Localization":
    mentors: [30, 31, 32, 33, 34, 35, 36, 37]
    # W. Edwards Deming, Elon Musk, Jeff Bezos, Steve Jobs,
    # Jack Welch, Sheryl Sandberg, Indra Nooyi, Mary Barra
    votingWeight: 1.1

# Productive Dissent Pairs
# System actively recruits dissenting voices for balanced decisions
dissentPairs:
  - mentor1: 1   # Warren Buffett
    mentor2: 84  # Soumith Chintala
    axis: "Baseline vs Novelty"

  - mentor1: 15  # Bruce Schneier
    mentor2: 18  # Peter Thiel
    axis: "Security vs Growth"

  - mentor1: 16  # Arvind Narayanan
    mentor2: 19  # Marc Andreessen
    axis: "Privacy vs Personalization"

  - mentor1: 5   # Paul Graham
    mentor2: 32  # Jeff Bezos
    axis: "Craft vs Scale"

  - mentor1: 27  # Geoffrey Hinton
    mentor2: 15  # Bruce Schneier
    axis: "AI Capability vs AI Safety"

  - mentor1: 3   # Nassim Taleb
    mentor2: 19  # Marc Andreessen
    axis: "Antifragility vs Velocity"

# Intent Classification Patterns
# Maps user command phrases to decision types
intentPatterns:
  strategy:
    keywords:
      - "positioning"
      - "differentiation"
      - "moat"
      - "long-term"
      - "competitive advantage"
      - "market strategy"
      - "vision"

  product_prfaq:
    keywords:
      - "feature"
      - "user experience"
      - "customer"
      - "interface"
      - "workflow"
      - "prfaq"
      - "product"

  infra_slo:
    keywords:
      - "performance"
      - "latency"
      - "reliability"
      - "slo"
      - "infrastructure"
      - "scalability"
      - "observability"

  safety_release:
    keywords:
      - "security"
      - "privacy"
      - "pdpa"
      - "compliance"
      - "release"
      - "deploy"
      - "rollout"

  capital_allocation:
    keywords:
      - "cost"
      - "pricing"
      - "budget"
      - "investment"
      - "economics"
      - "revenue"

# Escalation Rules
escalation:
  triggers:
    - condition: "votingThreshold not met"
      action: "escalate to Executive Board"

    - condition: "safety_release with RED risk"
      action: "escalate to Executive Board immediately"

    - condition: "cost > RM10,000 impact"
      action: "escalate to Executive Board"

    - condition: "dissent from Safety & Governance"
      action: "mandatory Executive Board review"

    - condition: "cross-cutting impact (3+ departments)"
      action: "escalate to Executive Board"

  executiveBoard:
    description: "See executive_board.json for composition and rules"
    quorum: 0.70  # 7/10 minimum
    passingScore: 9.0

# Composite Score Calculation
compositeScoring:
  method: "weighted average across recruited mentors"
  passingThreshold: 9.0  # Per-mentor minimum (0-10 scale)
  shipThreshold: 99.0    # Composite score to merge/ship (0-100 scale)

  rubricDimensions:
    - "SLO & error budget compliance"
    - "Observability (OTEL instrumentation)"
    - "Evals-as-code with baselines"
    - "Progressive delivery with auto-rollback"
    - "PDPA/TTL consent receipts"
    - "Cost ceilings"
    - "Prototype hygiene"
    - "AI POD centralization"

# Routing Algorithm (Pseudocode Reference)
routingAlgorithm:
  steps:
    - "Parse user command/intent"
    - "Classify into decision_type using intentPatterns"
    - "Identify primary + secondary departments"
    - "Recruit top-K mentors by lens weights"
    - "Add productive dissent pair if applicable"
    - "Execute mentor evaluation (8-step problem-solving patterns)"
    - "Calculate weighted vote and composite score"
    - "Check voting threshold"
    - "If threshold met and composite â‰¥99: APPROVE"
    - "If threshold not met or RED flags: ESCALATE"
    - "Log all decisions and dissent to dissent_ledger.md"

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="AI Bradaa - Malaysia's first AI-powered laptop intelligence platform. Find your perfect match with 7 powerful tools backed by 84 expert mentors.">
  <meta name="keywords" content="laptop finder, AI recommendations, laptop comparison, Malaysia tech, AI Bradaa, versus, explorer, command">
  <title>AI Bradaa - Malaysia's AI Laptop Advisor</title>

  <!-- Canonical URL -->
  <link rel="canonical" href="https://aibradaa.com/app.html">

  <!-- Open Graph Meta Tags -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://aibradaa.com/app.html">
  <meta property="og:title" content="AI Bradaa - Your Laptop Bradaa, Lah">
  <meta property="og:description" content="Malaysia's first AI-powered laptop intelligence platform. Find your perfect match in seconds with 7 powerful tools backed by 84 expert mentors.">
  <meta property="og:image" content="https://aibradaa.com/assets/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="AI Bradaa">
  <meta property="og:locale" content="en_MY">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://aibradaa.com/app.html">
  <meta name="twitter:title" content="AI Bradaa - Your Laptop Bradaa, Lah">
  <meta name="twitter:description" content="Malaysia's first AI-powered laptop intelligence platform. Find your perfect match in seconds with 7 powerful tools backed by 84 expert mentors.">
  <meta name="twitter:image" content="https://aibradaa.com/assets/og-image.jpg">
  <meta name="twitter:creator" content="@aibradaa">

  <!-- PWA Meta -->
  <meta name="theme-color" content="#D83F87">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://accounts.google.com https://www.gstatic.com https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob: https://www.google-analytics.com https://www.googletagmanager.com; connect-src 'self' https://generativelanguage.googleapis.com https://accounts.google.com https://www.google-analytics.com https://www.googletagmanager.com https://analytics.google.com; frame-src 'self' https://accounts.google.com; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests; report-uri /api/csp-report">

  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/styles/app.css">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "AI Bradaa",
    "description": "Malaysia's first AI-powered laptop intelligence platform. Find your perfect match in seconds, not weeks.",
    "url": "https://aibradaa.com/app.html",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "MYR",
      "availability": "https://schema.org/InStock"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "1247",
      "bestRating": "5",
      "worstRating": "1"
    },
    "author": {
      "@type": "Organization",
      "name": "AI Bradaa",
      "url": "https://aibradaa.com"
    }
  }
  </script>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX', {
      'send_page_view': true,
      'anonymize_ip': true,
      'cookie_flags': 'SameSite=None;Secure'
    });
  </script>
</head>
<body>
  <!-- App Shell -->
  <div id="app" class="app-container">

    <!-- Header/Navigation -->
    <header class="app-header">
      <div class="header-content">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span class="hamburger"></span>
          </button>
          <div class="logo">
            <span class="logo-text">AI Bradaa</span>
            <span class="logo-badge">BETA</span>
          </div>
        </div>

        <nav class="header-nav" id="headerNav">
          <a href="#matchmaker" class="nav-item" data-section="matchmaker">
            <span class="nav-icon">üéØ</span>
            <span class="nav-label">Matchmaker</span>
          </a>
          <a href="#versus" class="nav-item" data-section="versus">
            <span class="nav-icon">‚öîÔ∏è</span>
            <span class="nav-label">Versus</span>
          </a>
          <a href="#explorer" class="nav-item" data-section="explorer">
            <span class="nav-icon">üîç</span>
            <span class="nav-label">Explorer</span>
          </a>
          <a href="#command" class="nav-item active" data-section="command">
            <span class="nav-icon">ü§ñ</span>
            <span class="nav-label">Command</span>
          </a>
          <a href="#intel" class="nav-item nav-item-pro" data-section="intel">
            <span class="nav-icon">üìä</span>
            <span class="nav-label">Intel</span>
            <span class="pro-badge">PRO</span>
          </a>
          <a href="#appendices" class="nav-item" data-section="appendices">
            <span class="nav-icon">üìö</span>
            <span class="nav-label">Appendices</span>
          </a>
        </nav>

        <div class="header-right">
          <button class="header-btn" id="searchBtn" aria-label="Search">
            <span>üîç</span>
          </button>
          <button class="header-btn" id="notificationsBtn" aria-label="Notifications">
            <span>üîî</span>
          </button>
          <div class="user-menu">
            <button class="user-avatar" id="userMenuBtn">
              <img src="/assets/default-avatar.png" alt="User" id="userAvatar">
            </button>
            <div class="user-dropdown" id="userDropdown">
              <div class="user-info">
                <div class="user-name" id="userName">Guest</div>
                <div class="user-tier" id="userTier">Free Tier</div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#settings" class="dropdown-item">‚öôÔ∏è Settings</a>
              <a href="#upgrade" class="dropdown-item">‚≠ê Upgrade</a>
              <div class="dropdown-divider"></div>
              <button class="dropdown-item" id="logoutBtn">üö™ Logout</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="app-main" id="appMain">

      <!-- Section: Matchmaker -->
      <section id="section-matchmaker" class="app-section" data-section="matchmaker">
        <div class="section-container" id="matchmaker-container">
          <!-- Module will be loaded dynamically by app-core.js -->
        </div>
      </section>

      <!-- Section: Versus -->
      <section id="section-versus" class="app-section" data-section="versus">
        <div class="section-container" id="versus-container">
          <!-- Module will be loaded dynamically by app-core.js -->
        </div>
      </section>

      <!-- Section: Explorer -->
      <section id="section-explorer" class="app-section" data-section="explorer">
        <div class="section-container" id="explorer-container">
          <!-- Module will be loaded dynamically by app-core.js -->
        </div>
      </section>

      <!-- Section: Command (Default) -->
      <section id="section-command" class="app-section active" data-section="command">
        <div class="section-container" id="command-container">
          <!-- Module will be loaded dynamically by app-core.js -->
        </div>
      </section>

      <!-- Section: Intel (Pro) -->
      <section id="section-intel" class="app-section" data-section="intel">
        <div class="section-container" id="intel-container">
          <!-- Module will be loaded dynamically by app-core.js -->
        </div>
      </section>

      <!-- Section: Appendices -->
      <section id="section-appendices" class="app-section" data-section="appendices">
        <div class="section-container" id="appendices-container">
          <!-- Module will be loaded dynamically by app-core.js -->
        </div>
      </section>

    </main>

    <!-- Footer -->
    <footer class="app-footer">
      <div class="footer-content">
        <div class="footer-left">
          <span class="footer-text">¬© 2025 AI Bradaa. All rights reserved.</span>
        </div>
        <div class="footer-center">
          <a href="/privacy.html" class="footer-link">Privacy</a>
          <a href="/terms.html" class="footer-link">Terms</a>
          <a href="/about.html" class="footer-link">About</a>
        </div>
        <div class="footer-right">
          <span class="footer-text">Made with ‚ù§Ô∏è in Malaysia</span>
        </div>
      </div>
    </footer>

  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Modal Container -->
  <div id="modalContainer" class="modal-container"></div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading...</div>
  </div>

  <!-- Core Scripts -->
  <script src="/scripts/auth.js"></script>
  <script src="/scripts/app-core.js"></script>

  <!-- App Initialization -->
  <script>
    // Initialize app on load
    let appCore;
    let authManager;
    let authUI;

    async function initializeApp() {
      try {
        console.log('[App] Initializing...');

        // Create auth manager
        authManager = new AuthManager();
        authUI = new AuthUI(authManager);

        // Create app core
        appCore = new AppCore();

        // Initialize auth with callback
        await authManager.init((authState) => {
          console.log('[App] Auth state changed:', authState);

          // Update UI based on auth state
          if (authState.isAuthenticated && authState.user) {
            document.getElementById('userName').textContent = authState.user.name || authState.user.email;
            document.getElementById('userTier').textContent = `${authState.user.tier.charAt(0).toUpperCase() + authState.user.tier.slice(1)} Tier`;

            if (authState.user.avatar) {
              document.getElementById('userAvatar').src = authState.user.avatar;
            }
          } else {
            // Guest mode
            document.getElementById('userName').textContent = 'Guest';
            document.getElementById('userTier').textContent = 'Free Tier';
          }
        });

        // Initialize app core
        await appCore.init();

        // Expose globally for debugging and window callbacks
        window.appCore = appCore;
        window.authManager = authManager;
        window.authUI = authUI;

        console.log('[App] Initialization complete');

      } catch (error) {
        console.error('[App] Initialization failed:', error);

        // Show error toast if appCore is initialized
        if (appCore && appCore.showError) {
          appCore.showError('Application initialization failed. Some features may not work.', true);
        }
      } finally {
        // Hide loading overlay
        setTimeout(() => {
          const loadingOverlay = document.getElementById('loadingOverlay');
          if (loadingOverlay) {
            loadingOverlay.classList.add('hidden');
          }
        }, 500);
      }
    }

    // Setup menu toggle
    function setupMenuToggle() {
      const menuToggle = document.getElementById('menuToggle');
      const headerNav = document.getElementById('headerNav');

      if (menuToggle && headerNav) {
        menuToggle.addEventListener('click', () => {
          headerNav.classList.toggle('open');
          menuToggle.classList.toggle('open');
        });
      }
    }

    // Setup user menu
    function setupUserMenu() {
      const userMenuBtn = document.getElementById('userMenuBtn');
      const userDropdown = document.getElementById('userDropdown');
      const logoutBtn = document.getElementById('logoutBtn');

      if (userMenuBtn && userDropdown) {
        userMenuBtn.addEventListener('click', () => {
          userDropdown.classList.toggle('open');
        });

        // Close on click outside
        document.addEventListener('click', (e) => {
          if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
            userDropdown.classList.remove('open');
          }
        });
      }

      // Logout
      if (logoutBtn) {
        logoutBtn.addEventListener('click', async () => {
          if (window.authManager) {
            await window.authManager.logout();
            window.location.href = '/';
          }
        });
      }
    }

    // Setup navigation (click handlers for nav items)
    function setupNavigation() {
      const navItems = document.querySelectorAll('.nav-item');

      navItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();

          const sectionId = item.dataset.section;

          // Update URL hash (AppCore will handle loading)
          window.location.hash = sectionId;
        });
      });
    }

    // Initialize on DOMContentLoaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setupMenuToggle();
        setupUserMenu();
        setupNavigation();
        initializeApp();
      });
    } else {
      setupMenuToggle();
      setupUserMenu();
      setupNavigation();
      initializeApp();
    }
  </script>
</body>
</html>
